- name: SQL Deploy Report Check
  id: sql-deploy-report-check
  shell: powershell
  run: |
    $scriptPath = "${{ github.workspace }}\od-gha-files\SqlDeployReportCheck.ps1"
    $pathsArray = $env:OutPutPath -split ','
    $finalApprovalRequired = "false"  # Default value
    
    foreach ($path in $pathsArray) {
      # Capture the script output and exit code
      $output = & powershell -ExecutionPolicy Bypass -File $scriptPath -DeployReportPath $path 2>&1
      $exitCode = $LASTEXITCODE
      
      Write-Host "Script output for $path : $output"
      Write-Host "Exit code: $exitCode"
      
      # If any path requires approval, set final value to true
      if ($exitCode -eq 0 -and $env:ApprovalRequired -eq "true") {
        $finalApprovalRequired = "true"
      }
    }
    
    # Print the final value for verification
    Write-Host "Final ApprovalRequired value: $finalApprovalRequired"
    
    # Set outputs (using consistent naming)
    echo "ApprovalRequired=$finalApprovalRequired" >> $env:GITHUB_OUTPUT
    echo "approval_required=$finalApprovalRequired" >> $env:GITHUB_OUTPUT
    
    # Also set as environment variable for current job
    echo "ApprovalRequired=$finalApprovalRequired" >> $env:GITHUB_ENV
